(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[811],{5572:function(e,t,s){Promise.resolve().then(s.bind(s,3492))},7648:function(e,t,s){"use strict";s.d(t,{default:function(){return l.a}});var n=s(2972),l=s.n(n)},3492:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return i}});var n=s(7437),l=s(2265),a=s(7648);function r(e){if(!e)return{street:"",city:""};let t=e.split(",");if(t.length>=2)return{street:t[0].trim(),city:t.slice(1).join(",").trim()};let s=e.match(/^(.*?)(\d{4}\s+.+)$/);return s?{street:s[1].trim().replace(/,$/,""),city:s[2].trim()}:{street:e.trim(),city:""}}function i(){let[e,t]=(0,l.useState)(!1),[s,i]=(0,l.useState)(""),[d,c]=(0,l.useState)(!1),[o,u]=(0,l.useState)({email:"",tenantName:"",tenantAddress:"",tenantCity:"",propertyAddress:"",netRent:"",newRent:"",monthlyReduction:"",referenceRate:"",contractDate:"",landlordName:"",landlordAddress:"",landlordCity:"",letterLanguage:"de"});(0,l.useEffect)(()=>{(async()=>{let e=new URLSearchParams(window.location.search).get("contractId");if(e)try{console.log("\uD83D\uDCE5 Loading contract from DB, ID:",e);let t=await fetch("/api/user/contracts/".concat(e));if(t.ok){let{contract:e}=await t.json();console.log("✅ Loaded from DB:",e);let s=r(e.landlord_address||"");u(t=>{var n,l,a,r;return{...t,propertyAddress:e.address||"",netRent:(null===(n=e.net_rent)||void 0===n?void 0:n.toString())||"",newRent:(null===(l=e.new_rent)||void 0===l?void 0:l.toFixed(2))||"",monthlyReduction:(null===(a=e.monthly_reduction)||void 0===a?void 0:a.toFixed(2))||"",referenceRate:(null===(r=e.reference_rate)||void 0===r?void 0:r.toString())||"",contractDate:e.contract_date||"",landlordName:e.landlord_name||"",landlordAddress:s.street,landlordCity:s.city,tenantName:e.tenant_name||"",tenantAddress:e.tenant_address||""}}),c(!0);return}}catch(e){console.log("ℹ️ Could not load from DB, trying sessionStorage:",e)}if(window.sessionStorage){let e=sessionStorage.getItem("mietCheckData");if(e)try{var t;let s=JSON.parse(e);console.log("\uD83D\uDCE5 Loading data from sessionStorage:",s);let n=r((null===(t=s.contract)||void 0===t?void 0:t.landlordAddress)||"");u(e=>{var t,l,a,r,i,d,c,o,u,h,m;return{...e,propertyAddress:(null===(t=s.contract)||void 0===t?void 0:t.address)||"",netRent:(null===(a=s.contract)||void 0===a?void 0:null===(l=a.netRent)||void 0===l?void 0:l.toString())||"",newRent:(null===(i=s.calculation)||void 0===i?void 0:null===(r=i.newRent)||void 0===r?void 0:r.toFixed(2))||"",monthlyReduction:(null===(c=s.calculation)||void 0===c?void 0:null===(d=c.monthlyReduction)||void 0===d?void 0:d.toFixed(2))||"",referenceRate:(null===(u=s.contract)||void 0===u?void 0:null===(o=u.referenceRate)||void 0===o?void 0:o.toString())||"",contractDate:(null===(h=s.contract)||void 0===h?void 0:h.contractDate)||"",landlordName:(null===(m=s.contract)||void 0===m?void 0:m.landlordName)||"",landlordAddress:n.street,landlordCity:n.city}}),c(!0),console.log("✅ Auto-filled form from sessionStorage")}catch(e){console.error("❌ Error loading sessionStorage data:",e)}}})()},[]);let h=async()=>{let e=await fetch("/api/create-checkout",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({service:"generate",amount:5e3,email:o.email,metadata:o})}),{url:t}=await e.json();window.location.href=t},m=async e=>{e.preventDefault(),t(!0);try{let e=await fetch("/api/generate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)}),t=await e.blob(),s=window.URL.createObjectURL(t);i(s)}catch(e){alert("Fehler beim Generieren des Dokuments")}finally{t(!1)}};return(0,n.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,n.jsx)("header",{className:"bg-white shadow-sm",children:(0,n.jsx)("nav",{className:"container mx-auto px-4 py-4",children:(0,n.jsx)(a.default,{href:"/",className:"text-2xl font-bold text-primary",children:"MietCheck.ch"})})}),(0,n.jsx)("main",{className:"container mx-auto px-4 py-12",children:(0,n.jsx)("div",{className:"max-w-3xl mx-auto",children:(0,n.jsxs)("div",{className:"card mb-8",children:[(0,n.jsxs)("div",{className:"flex justify-between items-start mb-6",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h1",{className:"text-3xl font-bold mb-2",children:"Service 2: Dokument-Erstellung"}),(0,n.jsx)("p",{className:"text-gray-600",children:"Rechtssicheres Herabsetzungsbegehren - fertig zum Versand"}),d&&(0,n.jsx)("p",{className:"text-sm text-green-600 mt-2",children:"✓ Daten automatisch aus Service 1 \xfcbernommen"})]}),(0,n.jsxs)("div",{className:"text-right",children:[(0,n.jsx)("div",{className:"text-3xl font-bold text-primary",children:"CHF 50"}),(0,n.jsx)("div",{className:"text-sm text-gray-500",children:"einmalig"})]})]}),s?(0,n.jsxs)("div",{className:"space-y-6",children:[(0,n.jsxs)("div",{className:"bg-green-50 border-2 border-green-500 p-6 rounded-lg text-center",children:[(0,n.jsx)("div",{className:"text-6xl mb-4",children:"✅"}),(0,n.jsx)("h3",{className:"text-2xl font-bold text-green-800 mb-2",children:"Dokument erfolgreich erstellt!"}),(0,n.jsx)("p",{className:"text-gray-700",children:"Dein rechtssicheres Herabsetzungsbegehren ist bereit."})]}),(0,n.jsx)("div",{className:"text-center",children:(0,n.jsx)("a",{href:s,download:"herabsetzungsbegehren.pdf",className:"btn btn-primary inline-block text-lg",children:"\uD83D\uDCC4 PDF herunterladen"})}),(0,n.jsxs)("div",{className:"bg-blue-50 p-6 rounded-lg",children:[(0,n.jsx)("h4",{className:"font-semibold mb-3",children:"N\xe4chste Schritte:"}),(0,n.jsxs)("ol",{className:"space-y-2 text-sm text-gray-700",children:[(0,n.jsxs)("li",{children:[(0,n.jsx)("strong",{children:"1."})," PDF ausdrucken & unterschreiben"]}),(0,n.jsxs)("li",{children:[(0,n.jsx)("strong",{children:"2."})," Per Einschreiben (A-Post Plus) an Vermieter senden"]}),(0,n.jsxs)("li",{children:[(0,n.jsx)("strong",{children:"3."})," 30 Tage auf Antwort warten"]}),(0,n.jsxs)("li",{children:[(0,n.jsx)("strong",{children:"4."})," Bei Ablehnung: Schlichtungsbeh\xf6rde kontaktieren"]})]})]})]}):(0,n.jsxs)("form",{onSubmit:m,className:"space-y-8",children:[(0,n.jsxs)("div",{children:[(0,n.jsxs)("h3",{className:"text-lg font-semibold mb-4 flex items-center",children:[(0,n.jsx)("span",{className:"bg-primary text-white w-8 h-8 rounded-full flex items-center justify-center mr-2",children:"1"}),"Deine Daten"]}),(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"label",children:"E-Mail *"}),(0,n.jsx)("input",{type:"email",required:!0,className:"input",value:o.email,onChange:e=>u({...o,email:e.target.value})})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"label",children:"Dein Name *"}),(0,n.jsx)("input",{type:"text",required:!0,className:"input",value:o.tenantName,onChange:e=>u({...o,tenantName:e.target.value}),placeholder:"Max Muster"})]}),(0,n.jsxs)("div",{className:"grid md:grid-cols-2 gap-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"label",children:"Deine Adresse *"}),(0,n.jsx)("input",{type:"text",required:!0,className:"input",value:o.tenantAddress,onChange:e=>u({...o,tenantAddress:e.target.value}),placeholder:"Musterstrasse 123"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"label",children:"PLZ & Ort *"}),(0,n.jsx)("input",{type:"text",required:!0,className:"input",value:o.tenantCity,onChange:e=>u({...o,tenantCity:e.target.value}),placeholder:"8000 Z\xfcrich"})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"label",children:"Sprache des Briefes / Langue de la lettre / Lingua della lettera *"}),(0,n.jsxs)("select",{className:"input",value:o.letterLanguage,onChange:e=>u({...o,letterLanguage:e.target.value}),required:!0,children:[(0,n.jsx)("option",{value:"de",children:"\uD83C\uDDE9\uD83C\uDDEA Deutsch"}),(0,n.jsx)("option",{value:"fr",children:"\uD83C\uDDEB\uD83C\uDDF7 Fran\xe7ais"}),(0,n.jsx)("option",{value:"it",children:"\uD83C\uDDEE\uD83C\uDDF9 Italiano"})]}),(0,n.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:"W\xe4hlen Sie die Sprache f\xfcr den Herabsetzungsbrief. Diese ist unabh\xe4ngig von der Sprache der Benutzeroberfl\xe4che."})]})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsxs)("h3",{className:"text-lg font-semibold mb-4 flex items-center",children:[(0,n.jsx)("span",{className:"bg-primary text-white w-8 h-8 rounded-full flex items-center justify-center mr-2",children:"2"}),"Mietvertrag",d&&(0,n.jsx)("span",{className:"ml-2 text-sm text-green-600",children:"(automatisch ausgef\xfcllt)"})]}),(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"label",children:"Adresse der Mietwohnung *"}),(0,n.jsx)("input",{type:"text",required:!0,className:"input",value:o.propertyAddress,onChange:e=>u({...o,propertyAddress:e.target.value}),placeholder:"Wohnstrasse 456, 8000 Z\xfcrich"})]}),(0,n.jsxs)("div",{className:"grid md:grid-cols-4 gap-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"label",children:"Aktuelle Miete (CHF) *"}),(0,n.jsx)("input",{type:"number",required:!0,step:"0.01",className:"input",value:o.netRent,onChange:e=>u({...o,netRent:e.target.value}),placeholder:"2000"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"label",children:"Neue Miete (CHF) *"}),(0,n.jsx)("input",{type:"number",required:!0,step:"0.01",className:"input bg-green-50",value:o.newRent,onChange:e=>u({...o,newRent:e.target.value}),placeholder:"1900"}),(0,n.jsx)("p",{className:"text-xs text-green-600 mt-1",children:"Berechnete Sollmiete"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"label",children:"Referenzzinssatz *"}),(0,n.jsxs)("select",{required:!0,className:"input",value:o.referenceRate,onChange:e=>u({...o,referenceRate:e.target.value}),children:[(0,n.jsx)("option",{value:"",children:"W\xe4hlen"}),(0,n.jsx)("option",{value:"1.25",children:"1.25%"}),(0,n.jsx)("option",{value:"1.50",children:"1.50%"}),(0,n.jsx)("option",{value:"1.75",children:"1.75%"}),(0,n.jsx)("option",{value:"2.00",children:"2.00%"})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"label",children:"Vertragsdatum *"}),(0,n.jsx)("input",{type:"date",required:!0,className:"input",value:o.contractDate,onChange:e=>u({...o,contractDate:e.target.value})})]})]}),o.monthlyReduction&&parseFloat(o.monthlyReduction)>0&&(0,n.jsxs)("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[(0,n.jsxs)("p",{className:"text-sm font-medium text-green-800",children:["\uD83D\uDCB0 Monatliche Einsparung: CHF ",parseFloat(o.monthlyReduction).toFixed(2)]}),(0,n.jsxs)("p",{className:"text-sm text-green-600",children:["J\xe4hrlich: CHF ",(12*parseFloat(o.monthlyReduction)).toFixed(2)]})]})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsxs)("h3",{className:"text-lg font-semibold mb-4 flex items-center",children:[(0,n.jsx)("span",{className:"bg-primary text-white w-8 h-8 rounded-full flex items-center justify-center mr-2",children:"3"}),"Vermieter",d&&(0,n.jsx)("span",{className:"ml-2 text-sm text-green-600",children:"(automatisch ausgef\xfcllt)"})]}),(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"label",children:"Name des Vermieters *"}),(0,n.jsx)("input",{type:"text",required:!0,className:"input",value:o.landlordName,onChange:e=>u({...o,landlordName:e.target.value}),placeholder:"Immobilien AG"})]}),(0,n.jsxs)("div",{className:"grid md:grid-cols-2 gap-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"label",children:"Adresse *"}),(0,n.jsx)("input",{type:"text",required:!0,className:"input",value:o.landlordAddress,onChange:e=>u({...o,landlordAddress:e.target.value}),placeholder:"Hausverwaltung 1"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"label",children:"PLZ & Ort *"}),(0,n.jsx)("input",{type:"text",required:!0,className:"input",value:o.landlordCity,onChange:e=>u({...o,landlordCity:e.target.value}),placeholder:"8000 Z\xfcrich"})]})]})]})]}),(0,n.jsxs)("div",{className:"bg-green-50 border border-green-200 p-6 rounded-lg",children:[(0,n.jsx)("h4",{className:"font-semibold mb-3",children:"Was du erh\xe4ltst:"}),(0,n.jsxs)("ul",{className:"space-y-2 text-sm text-gray-700",children:[(0,n.jsx)("li",{children:"✓ Alle Funktionen von Service 1 (Analyse)"}),(0,n.jsx)("li",{children:"✓ Fertiges Herabsetzungsbegehren als PDF"}),(0,n.jsx)("li",{children:"✓ Rechtssicher nach Art. 13 VMWG"}),(0,n.jsx)("li",{children:"✓ Personalisiert mit all deinen Daten"}),(0,n.jsx)("li",{children:"✓ Bereit zum Ausdrucken & Versenden"}),(0,n.jsx)("li",{children:"✓ Anleitung f\xfcr Einschreiben-Versand"})]})]}),(0,n.jsx)("button",{type:"button",onClick:h,className:"btn btn-primary w-full text-lg",children:"Jetzt f\xfcr CHF 50 Dokument erstellen →"})]})]})})})]})}}},function(e){e.O(0,[972,971,117,744],function(){return e(e.s=5572)}),_N_E=e.O()}]);