(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[478],{7713:function(e,s,n){Promise.resolve().then(n.bind(n,859))},7648:function(e,s,n){"use strict";n.d(s,{default:function(){return r.a}});var t=n(2972),r=n.n(t)},9376:function(e,s,n){"use strict";var t=n(5475);n.o(t,"useRouter")&&n.d(s,{useRouter:function(){return t.useRouter}}),n.o(t,"useSearchParams")&&n.d(s,{useSearchParams:function(){return t.useSearchParams}})},859:function(e,s,n){"use strict";n.r(s),n.d(s,{default:function(){return d}});var t=n(7437),r=n(2265),a=n(9376),i=n(7648);function l(){var e;let s=(0,a.useSearchParams)(),n=s.get("session_id"),l=s.get("service")||"generate",[c,d]=(0,r.useState)(!0),[m,h]=(0,r.useState)(null),[x,o]=(0,r.useState)(!1),[u,f]=(0,r.useState)(null),[j,N]=(0,r.useState)(null);async function p(e){if(e){o(!0);try{let s={email:e.email||"",tenantName:e.tenantName||"",tenantAddress:e.tenantAddress||"",tenantCity:e.tenantCity||"",propertyAddress:e.propertyAddress||"",netRent:e.netRent||"",newRent:e.newRent||"",monthlyReduction:e.monthlyReduction||"",referenceRate:e.referenceRate||"",contractDate:e.contractDate||"",landlordName:e.landlordName||"",landlordAddress:e.landlordAddress||"",landlordCity:e.landlordCity||""},n=await fetch("/api/generate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!n.ok)throw Error("PDF generation failed");let t=await n.blob(),r=window.URL.createObjectURL(t);f(r)}catch(e){console.error("PDF generation error:",e),N("PDF konnte nicht generiert werden. Bitte kontaktieren Sie den Support.")}finally{o(!1)}}}return((0,r.useEffect)(()=>{if(!n){N("Keine Session-ID gefunden"),d(!1);return}(async function(){try{let s=await fetch("/api/verify-payment",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sessionId:n})}),t=await s.json();if(h(t),t.verified&&"generate"===l){var e;await p(null===(e=t.session)||void 0===e?void 0:e.metadata)}}catch(e){N("Fehler bei der Zahlungsverifizierung"),console.error(e)}finally{d(!1)}})()},[n,l]),c)?(0,t.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"}),(0,t.jsx)("p",{className:"text-gray-600",children:"Zahlung wird verifiziert..."})]})}):!j&&(null==m?void 0:m.verified)?(0,t.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,t.jsx)("header",{className:"bg-white shadow-sm",children:(0,t.jsx)("nav",{className:"container mx-auto px-4 py-4",children:(0,t.jsx)(i.default,{href:"/",className:"text-2xl font-bold text-primary",children:"MietCheck.ch"})})}),(0,t.jsx)("main",{className:"container mx-auto px-4 py-12",children:(0,t.jsxs)("div",{className:"max-w-2xl mx-auto",children:[(0,t.jsx)("div",{className:"card mb-8",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"text-6xl mb-4",children:"✅"}),(0,t.jsx)("h1",{className:"text-3xl font-bold text-green-600 mb-2",children:"Zahlung erfolgreich!"}),(0,t.jsxs)("p",{className:"text-gray-600",children:["Vielen Dank f\xfcr Ihren Kauf. Ihre Quittung wird an ",null===(e=m.session)||void 0===e?void 0:e.customerEmail," gesendet."]})]})}),"generate"===l&&(0,t.jsxs)("div",{className:"card mb-8",children:[(0,t.jsx)("h2",{className:"text-xl font-bold mb-4",children:"Ihr Herabsetzungsbegehren"}),x?(0,t.jsxs)("div",{className:"text-center py-8",children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-10 w-10 border-b-2 border-primary mx-auto mb-4"}),(0,t.jsx)("p",{className:"text-gray-600",children:"PDF wird generiert..."})]}):u?(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:(0,t.jsx)("p",{className:"text-green-800 font-medium",children:"✓ Ihr Dokument ist bereit zum Download"})}),(0,t.jsx)("a",{href:u,download:"herabsetzungsbegehren.pdf",className:"btn btn-primary w-full text-center text-lg block",children:"\uD83D\uDCC4 PDF herunterladen"}),(0,t.jsx)("p",{className:"text-sm text-gray-500 text-center",children:"Sie k\xf6nnen das PDF jederzeit erneut herunterladen, solange diese Seite ge\xf6ffnet ist."})]}):(0,t.jsxs)("div",{className:"text-center py-8",children:[(0,t.jsx)("p",{className:"text-gray-600 mb-4",children:"PDF konnte nicht automatisch generiert werden."}),(0,t.jsx)("button",{onClick:()=>{var e;return p(null===(e=m.session)||void 0===e?void 0:e.metadata)},className:"btn btn-primary",children:"PDF erneut generieren"})]})]}),(0,t.jsxs)("div",{className:"card",children:[(0,t.jsx)("h2",{className:"text-xl font-bold mb-4",children:"N\xe4chste Schritte"}),(0,t.jsxs)("ol",{className:"space-y-4",children:[(0,t.jsxs)("li",{className:"flex items-start",children:[(0,t.jsx)("span",{className:"bg-primary text-white w-8 h-8 rounded-full flex items-center justify-center mr-3 flex-shrink-0",children:"1"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-medium",children:"PDF ausdrucken"}),(0,t.jsx)("p",{className:"text-sm text-gray-600",children:"Drucken Sie das Dokument auf weissem A4-Papier aus."})]})]}),(0,t.jsxs)("li",{className:"flex items-start",children:[(0,t.jsx)("span",{className:"bg-primary text-white w-8 h-8 rounded-full flex items-center justify-center mr-3 flex-shrink-0",children:"2"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-medium",children:"Unterschreiben"}),(0,t.jsx)("p",{className:"text-sm text-gray-600",children:"Unterschreiben Sie den Brief handschriftlich im vorgesehenen Feld."})]})]}),(0,t.jsxs)("li",{className:"flex items-start",children:[(0,t.jsx)("span",{className:"bg-primary text-white w-8 h-8 rounded-full flex items-center justify-center mr-3 flex-shrink-0",children:"3"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-medium",children:"Per Einschreiben versenden"}),(0,t.jsx)("p",{className:"text-sm text-gray-600",children:"Senden Sie den Brief als Einschreiben (A-Post Plus) an Ihren Vermieter. Bewahren Sie den Einlieferungsbeleg auf!"})]})]}),(0,t.jsxs)("li",{className:"flex items-start",children:[(0,t.jsx)("span",{className:"bg-primary text-white w-8 h-8 rounded-full flex items-center justify-center mr-3 flex-shrink-0",children:"4"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-medium",children:"30 Tage warten"}),(0,t.jsx)("p",{className:"text-sm text-gray-600",children:"Ihr Vermieter hat 30 Tage Zeit, Ihnen auf dem amtlichen Formular zu antworten."})]})]}),(0,t.jsxs)("li",{className:"flex items-start",children:[(0,t.jsx)("span",{className:"bg-primary text-white w-8 h-8 rounded-full flex items-center justify-center mr-3 flex-shrink-0",children:"5"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-medium",children:"Bei Ablehnung: Schlichtungsbeh\xf6rde"}),(0,t.jsx)("p",{className:"text-sm text-gray-600",children:"Falls Ihr Vermieter nicht antwortet oder ablehnt, k\xf6nnen Sie sich kostenlos an die Schlichtungsbeh\xf6rde Ihres Bezirks wenden."})]})]})]})]}),(0,t.jsx)("div",{className:"mt-8 text-center",children:(0,t.jsxs)("p",{className:"text-gray-600",children:["Fragen? Kontaktieren Sie uns unter"," ",(0,t.jsx)("a",{href:"mailto:support@mietcheck.ch",className:"text-primary hover:underline",children:"support@mietcheck.ch"})]})})]})})]}):(0,t.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,t.jsx)("header",{className:"bg-white shadow-sm",children:(0,t.jsx)("nav",{className:"container mx-auto px-4 py-4",children:(0,t.jsx)(i.default,{href:"/",className:"text-2xl font-bold text-primary",children:"MietCheck.ch"})})}),(0,t.jsx)("main",{className:"container mx-auto px-4 py-12",children:(0,t.jsx)("div",{className:"max-w-xl mx-auto",children:(0,t.jsxs)("div",{className:"card text-center",children:[(0,t.jsx)("div",{className:"text-6xl mb-4",children:"⚠️"}),(0,t.jsx)("h1",{className:"text-2xl font-bold text-red-600 mb-4",children:"Zahlung konnte nicht verifiziert werden"}),(0,t.jsx)("p",{className:"text-gray-600 mb-6",children:j||(null==m?void 0:m.error)||"Die Zahlung wurde nicht abgeschlossen."}),(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsx)(i.default,{href:"/generate",className:"btn btn-primary w-full",children:"Zur\xfcck zur Dokumenterstellung"}),(0,t.jsx)(i.default,{href:"/",className:"btn btn-outline w-full",children:"Zur Startseite"})]})]})})})]})}function c(){return(0,t.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"}),(0,t.jsx)("p",{className:"text-gray-600",children:"Laden..."})]})})}function d(){return(0,t.jsx)(r.Suspense,{fallback:(0,t.jsx)(c,{}),children:(0,t.jsx)(l,{})})}}},function(e){e.O(0,[972,971,117,744],function(){return e(e.s=7713)}),_N_E=e.O()}]);