(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[241],{7591:function(e,t,s){Promise.resolve().then(s.bind(s,9379))},9379:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return N}});var n=s(7437),a=s(2265),r=s(9376),l=s(7648),i=s(3428),d=s(9064);let c=e=>{d.ZP.success(e)},o=e=>{d.ZP.error(e)},u=e=>d.ZP.loading(e),h=e=>{d.ZP.dismiss(e)},g={uploadStart:"Dokument wird hochgeladen...",analysisStart:"Vertrag wird analysiert...",analysisSuccess:"Analyse abgeschlossen",analysisTimeout:"Analyse dauert zu lange. Bitte erneut versuchen.",networkError:"Netzwerkfehler. Bitte Internetverbindung pr\xfcfen.",serverError:"Serverfehler. Bitte sp\xe4ter erneut versuchen.",genericError:"Ein Fehler ist aufgetreten. Bitte erneut versuchen."};async function m(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{maxRetries:s=3,delay:n=1e3,onRetry:a}=t,r=null;for(let t=1;t<=s;t++)try{return await e()}catch(e){r=e instanceof Error?e:Error(String(e)),t<s&&(null==a||a(t),d.ZP.loading("Versuch ".concat(t+1," von ").concat(s,"..."),{duration:n}),await new Promise(e=>setTimeout(e,n)))}throw r}let x=["application/pdf","image/jpeg","image/png","image/jpg"],p=[".pdf",".jpg",".jpeg",".png"];function b(e){let{onAnalysisComplete:t}=e,[s,r]=(0,a.useState)(!1),[l,d]=(0,a.useState)(!1),[b,f]=(0,a.useState)(0),[y,j]=(0,a.useState)(""),z=(0,a.useRef)(null),N=e=>{var t;if(e.size>10485760)return"Datei ist zu gross (".concat((e.size/1024/1024).toFixed(1)," MB). Maximum: 10 MB");let s="."+(null===(t=e.name.split(".").pop())||void 0===t?void 0:t.toLowerCase());return x.includes(e.type)||p.includes(s)?0===e.size?"Die Datei ist leer. Bitte w\xe4hlen Sie eine andere Datei.":null:"Ung\xfcltiges Dateiformat: ".concat(e.type||s,". Erlaubt: PDF, JPG, PNG")},D=()=>{r(!1),d(!1),f(0),z.current&&(z.current.value="")},v=async e=>{var s,n,a,l,x,p;let b=null===(s=e.target.files)||void 0===s?void 0:s[0];if(!b)return;let y=N(b);if(y){o(y),D();return}r(!0),f(10),j(b.name);let z=null;try{z=u(g.uploadStart),console.log("\uD83D\uDCE4 Uploading file:",b.name,b.type),f(20);let e=await (0,i.ws)(b.name,b,{access:"public",handleUploadUrl:"/api/upload-url"});h(z),console.log("✅ Upload successful:",e.url),f(40),r(!1),d(!0),z=u("Text wird extrahiert..."),console.log("\uD83D\uDD04 Processing upload with type:",b.type),f(50);let s=await m(async()=>{let t=await fetch("/api/process-upload",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({blobUrl:e.url,fileType:b.type})});if(!t.ok){let e=await t.json();throw Error(e.error||"Dateiverarbeitung fehlgeschlagen")}return t},{maxRetries:2,delay:1500});h(z),f(70);let{extractedText:n}=await s.json();if(console.log("✅ Text extracted, length:",null==n?void 0:n.length),!n||n.length<50)throw Error("Der Vertrag konnte nicht gelesen werden. Bitte stellen Sie sicher, dass das Dokument gut lesbar ist.");z=u(g.analysisStart),console.log("\uD83E\uDD16 Analyzing contract..."),f(80);let a=await m(async()=>{let e=await fetch("/api/analyze-contract",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({extractedText:n})});if(!e.ok){let t=await e.json();throw Error(t.error||"Analyse fehlgeschlagen")}return e},{maxRetries:2,delay:2e3});h(z),f(100);let l=await a.json();if(console.log("✅ Analysis complete:",l),!l.data&&!l.success)throw Error(l.error||"Analyse lieferte keine Daten");let o=l.data||l;c(g.analysisSuccess),t(o),d(!1)}catch(t){console.error("❌ Upload/Analysis error:",t),z&&h(z);let e=t.message||g.genericError;(null===(n=t.message)||void 0===n?void 0:n.includes("fetch"))||(null===(a=t.message)||void 0===a?void 0:a.includes("network"))?e=g.networkError:(null===(l=t.message)||void 0===l?void 0:l.includes("timeout"))?e="Die Analyse hat zu lange gedauert. Bitte versuchen Sie es mit einem kleineren Dokument.":((null===(x=t.message)||void 0===x?void 0:x.includes("rate limit"))||(null===(p=t.message)||void 0===p?void 0:p.includes("429")))&&(e="Zu viele Anfragen. Bitte warten Sie einen Moment und versuchen Sie es erneut."),o(e),D()}},w=s||l;return(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsxs)("div",{className:"\n          border-2 border-dashed rounded-lg p-8 text-center transition-all duration-200\n          ".concat(w?"border-blue-300 bg-blue-50":"border-gray-300 hover:border-blue-500 hover:bg-gray-50","\n        "),onDragOver:e=>{e.preventDefault(),e.stopPropagation()},onDrop:e=>{e.preventDefault(),e.stopPropagation();let t=e.dataTransfer.files;if(t.length>0&&z.current){let e=new DataTransfer;e.items.add(t[0]),z.current.files=e.files;let s=new Event("change",{bubbles:!0});z.current.dispatchEvent(s)}},children:[(0,n.jsx)("input",{ref:z,type:"file",accept:".pdf,.jpg,.jpeg,.png",onChange:v,disabled:w,className:"hidden",id:"file-upload"}),(0,n.jsxs)("label",{htmlFor:"file-upload",className:"cursor-pointer block ".concat(w?"cursor-not-allowed":""),children:[(0,n.jsx)("div",{className:"text-6xl mb-4",children:s?"\uD83D\uDCE4":l?"\uD83E\uDD16":"\uD83D\uDCC4"}),(0,n.jsx)("div",{className:"text-lg font-medium text-gray-700 mb-2",children:s?"Wird hochgeladen...":l?"KI analysiert den Vertrag...":"Mietvertrag hochladen"}),(0,n.jsx)("div",{className:"text-sm text-gray-500",children:y?(0,n.jsx)("span",{className:"text-blue-600",children:y}):(0,n.jsxs)(n.Fragment,{children:["Klicken oder Datei hierher ziehen",(0,n.jsx)("br",{}),(0,n.jsx)("span",{className:"text-xs",children:"PDF, JPG oder PNG (max. 10 MB)"})]})})]})]}),w&&(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)("div",{className:"h-2 bg-gray-200 rounded-full overflow-hidden",children:(0,n.jsx)("div",{className:"h-full bg-blue-600 transition-all duration-500 ease-out",style:{width:"".concat(b,"%")}})}),(0,n.jsxs)("div",{className:"flex justify-between text-xs text-gray-500",children:[(0,n.jsxs)("span",{children:[b<40&&"Hochladen...",b>=40&&b<70&&"Text extrahieren...",b>=70&&b<100&&"KI-Analyse...",100===b&&"Fertig!"]}),(0,n.jsxs)("span",{children:[b,"%"]})]})]}),!w&&!y&&(0,n.jsxs)("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4 text-sm text-gray-600",children:[(0,n.jsx)("p",{className:"font-medium mb-2",children:"\uD83D\uDCA1 Tipps f\xfcr beste Ergebnisse:"}),(0,n.jsxs)("ul",{className:"list-disc list-inside space-y-1",children:[(0,n.jsx)("li",{children:"Verwenden Sie gut lesbare Scans oder Fotos"}),(0,n.jsx)("li",{children:"Stellen Sie sicher, dass alle Seiten gerade sind"}),(0,n.jsx)("li",{children:"Bei Fotos: Gute Beleuchtung ohne Schatten"})]})]})]})}let f=[{datum:"2025-09-02",satz:1.25},{datum:"2025-03-03",satz:1.5},{datum:"2023-12-01",satz:1.75},{datum:"2023-06-01",satz:1.5},{datum:"2022-12-01",satz:1.25},{datum:"2022-03-02",satz:1.25},{datum:"2020-03-02",satz:1.25},{datum:"2019-06-03",satz:1.25},{datum:"2017-06-01",satz:1.5},{datum:"2016-09-01",satz:1.5},{datum:"2015-09-01",satz:1.75}];function y(e,t,s){return Math.round(e*(1+(s-t)/.25*3/100)*100)/100}function j(e,t,s,n){let a=[],r=e,l=t,i=new Date(s),d=new Date(n);for(let e of f.filter(e=>{let t=new Date(e.datum);return t>i&&t<=d}).reverse())e.satz!==l&&(r=y(r,l,e.satz),l=e.satz,a.push({datum:e.datum,zins:l,miete:r}));return{sollMiete:r,schritte:a}}function z(e){let{vertragsbeginn:t,onHistorieChange:s}=e,[r,l]=(0,a.useState)([]),[d,c]=(0,a.useState)(!1),[o,u]=(0,a.useState)(!1),[h,g]=(0,a.useState)(!1),[m,x]=(0,a.useState)(null),[p,b]=(0,a.useState)(""),[z,N]=(0,a.useState)(""),[D,v]=(0,a.useState)(""),[w,C]=(0,a.useState)(""),[S,k]=(0,a.useState)(""),[F,R]=(0,a.useState)([]),M={datum:t.datum,referenzzinssatz:t.referenzzinssatz,miete:t.miete,typ:"start"},A=r.length>0?r[r.length-1]:M,H=e=>{if(v(e),e&&!isNaN(parseFloat(e))){let t=A.referenzzinssatz;C(y(A.miete,t,parseFloat(e)).toFixed(2))}},E=async e=>{var t;let s=null===(t=e.target.files)||void 0===t?void 0:t[0];if(s){g(!0);try{console.log("\uD83D\uDCE4 Uploading adjustment document...");let e=await (0,i.ws)(s.name,s,{access:"public",handleUploadUrl:"/api/upload-url"});b(e.url),console.log("✅ Upload successful:",e.url),console.log("\uD83E\uDD16 Analyzing adjustment document...");let t=await fetch("/api/analyze-anpassung",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({blobUrl:e.url})});if(!t.ok)throw Error("Analyse fehlgeschlagen");let n=await t.json();console.log("✅ Analysis complete:",n),x(n.data)}catch(e){console.error("❌ Upload/Analysis error:",e),alert("Fehler: "+e.message)}finally{g(!1)}}},B=e=>{let t=[...r,e].sort((e,t)=>new Date(e.datum).getTime()-new Date(t.datum).getTime());l(t),s({vertragsbeginn:M,anpassungen:t,aktuell:e})},T=e=>{let t=r.filter((t,s)=>s!==e);l(t),s({vertragsbeginn:M,anpassungen:t,aktuell:t.length>0?t[t.length-1]:M})},G=function(e){let t=[],s=[],n=[],a=[],r=[],l=[],i=[e.vertragsbeginn.datum,...e.anpassungen.map(e=>e.datum)];for(let e=1;e<i.length;e++)new Date(i[e])<=new Date(i[e-1])&&t.push("Datum ".concat(i[e]," ist nicht chronologisch nach ").concat(i[e-1]));let d=e.vertragsbeginn;for(let t=0;t<e.anpassungen.length;t++){let n=e.anpassungen[t];!function(e,t){let s=new Date(e),n=new Date(t);f.filter(e=>{let t=new Date(e.datum);return t>s&&t<=n}).reverse()}(d.datum,n.datum);let{sollMiete:i,schritte:c}=j(d.miete,d.referenzzinssatz,d.datum,n.datum),o=c.length>0?c[c.length-1].zins:d.referenzzinssatz;if(c.length>1){let e=c.slice(0,-1);r.push("Zwischen ".concat(new Date(d.datum).toLocaleDateString("de-CH")," ")+"und ".concat(new Date(n.datum).toLocaleDateString("de-CH")," ")+"wurden ".concat(e.length," Zins\xe4nderung(en) \xfcbersprungen: ")+e.map(e=>"".concat(new Date(e.datum).toLocaleDateString("de-CH"),": ").concat(e.zins,"%")).join(", "))}let u=n.referenzzinssatz-o,h=n.miete-i,g="korrekt",m="";Math.abs(h)>1?h>0?(g="zu_hoch",m="Miete ist CHF ".concat(h.toFixed(2)," zu hoch"),n.zusaetzlicheGruende&&n.zusaetzlicheGruende.length>0?s.push("Anpassung ".concat(new Date(n.datum).toLocaleDateString("de-CH"),": ")+"Miete CHF ".concat(n.miete.toFixed(2)," ist h\xf6her als Referenzzins-Berechnung ")+"(CHF ".concat(i.toFixed(2),"). Zus\xe4tzliche Gr\xfcnde: ").concat(n.zusaetzlicheGruende.join(", "),". ")+"Bitte pr\xfcfen Sie die Rechtm\xe4\xdfigkeit dieser Zusatzerh\xf6hung."):l.push("Anpassung ".concat(new Date(n.datum).toLocaleDateString("de-CH"),": ")+"Miete sollte CHF ".concat(i.toFixed(2)," sein (Referenzzins ").concat(o,"%), ")+"ist aber CHF ".concat(n.miete.toFixed(2)," (Referenzzins ").concat(n.referenzzinssatz,"%). ")+"Differenz: CHF ".concat(h.toFixed(2)," zu hoch! ")+"KEINE zus\xe4tzlichen Gr\xfcnde angegeben.")):(g="zu_niedrig",m="Miete ist CHF ".concat(Math.abs(h).toFixed(2)," zu niedrig (selten, aber m\xf6glich)")):m="Berechnung korrekt",a.push({datum:n.datum,sollReferenzzins:o,istReferenzzins:n.referenzzinssatz,sollMiete:i,istMiete:n.miete,differenzZins:u,differenzMiete:h,status:g,erklaerung:m}),d=n}f[0].satz,f[0].datum;let c=e.aktuell||d,{sollMiete:o,schritte:u}=j(c.miete,c.referenzzinssatz,c.datum,new Date().toISOString().split("T")[0]);if(u.length>0){let e=u[u.length-1];if(e.zins<c.referenzzinssatz){let i=c.miete-o;if(i>1){let d=e.datum,u=new Date(d),h=Math.floor((new Date().getTime()-u.getTime())/2630016e3),g=i*h;return n.push("❌ KRITISCH: Nicht-ber\xfccksichtigte Zinssenkung!","","Seit ".concat(new Date(d).toLocaleDateString("de-CH")," ist der Referenzzins bei ").concat(e.zins,"%"),"Ihre Miete basiert noch auf ".concat(c.referenzzinssatz,"%"),"","Differenz: ".concat((e.zins-c.referenzzinssatz).toFixed(2),"% ")+"(".concat(Math.abs((e.zins-c.referenzzinssatz)/.25)," Schritte \xe0 0.25%)"),"Reduzierung: ".concat(((e.miete-c.miete)/c.miete*100).toFixed(2),"%"),"","\uD83D\uDCB0 SIE HABEN ANSPRUCH AUF:","• Sollmiete: CHF ".concat(o.toFixed(2),"/Monat"),"• Aktuelle Miete: CHF ".concat(c.miete.toFixed(2),"/Monat"),"• Reduzierung: CHF ".concat(i.toFixed(2),"/Monat"),"• R\xfcckwirkend ab: ".concat(new Date(d).toLocaleDateString("de-CH")," (").concat(h," Monate)"),"• Nachzahlung: CHF ".concat(g.toFixed(2))),a.push({datum:d,sollReferenzzins:e.zins,istReferenzzins:c.referenzzinssatz,sollMiete:o,istMiete:c.miete,differenzZins:e.zins-c.referenzzinssatz,differenzMiete:i,status:"fehlend",erklaerung:"Zinssenkung wurde NICHT ber\xfccksichtigt - Anspruch auf Mietreduzierung!"}),{isValid:!1,errors:t,warnings:s,kritisch:n,sollIstVergleiche:a,uebersprungeneSchritte:r,falscheberechnungen:l,einsparungsPotential:{monatlich:i,jaehrlich:12*i,rueckwirkendAb:d,rueckwirkendMonate:h,nachzahlung:g}}}}}return{isValid:0===t.length&&0===n.length,errors:t,warnings:s,kritisch:n,sollIstVergleiche:a,uebersprungeneSchritte:r,falscheberechnungen:l}}({vertragsbeginn:M,anpassungen:r,aktuell:A});return(0,n.jsxs)("div",{className:"space-y-6",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between flex-wrap gap-2",children:[(0,n.jsx)("h3",{className:"text-xl font-bold text-gray-900",children:"\uD83D\uDCCA Mietanpassungs-Historie"}),(0,n.jsxs)("div",{className:"flex gap-2",children:[(0,n.jsx)("button",{onClick:()=>u(!o),className:"bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors text-sm",children:o?"✕ Abbrechen":"\uD83D\uDCC4 Dokument hochladen"}),(0,n.jsx)("button",{onClick:()=>c(!d),className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors text-sm",children:d?"✕ Abbrechen":"✏️ Manuell erfassen"})]})]}),(0,n.jsx)("p",{className:"text-gray-600 text-sm",children:"Laden Sie Mieterh\xf6hungs-/Reduktionsbriefe hoch oder erfassen Sie Anpassungen manuell. Das System validiert automatisch die Berechnungen und zeigt Ihr Einsparungspotential."}),o&&(0,n.jsxs)("div",{className:"bg-green-50 border border-green-200 rounded-lg p-6 space-y-4",children:[(0,n.jsx)("h4",{className:"font-bold text-gray-900",children:"\uD83D\uDCC4 Anpassungs-Dokument hochladen"}),m?(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsxs)("div",{className:"bg-white border border-gray-300 rounded-lg p-4 space-y-3",children:[(0,n.jsx)("h5",{className:"font-bold text-gray-900",children:"\uD83D\uDCCB Analysierte Daten:"}),(0,n.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-gray-600",children:"Datum"}),(0,n.jsx)("input",{type:"date",value:m.datum,onChange:e=>x({...m,datum:e.target.value}),className:"w-full px-2 py-1 border rounded"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-gray-600",children:"Typ"}),(0,n.jsx)("p",{className:"font-medium",children:"erh\xf6hung"===m.typ?"↑ Erh\xf6hung":"↓ Reduzierung"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-gray-600",children:"Alt: Referenzzins"}),(0,n.jsx)("input",{type:"number",step:"0.25",value:m.alterReferenzzinssatz,onChange:e=>x({...m,alterReferenzzinssatz:parseFloat(e.target.value)}),className:"w-full px-2 py-1 border rounded"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-gray-600",children:"Neu: Referenzzins"}),(0,n.jsx)("input",{type:"number",step:"0.25",value:m.neuerReferenzzinssatz,onChange:e=>x({...m,neuerReferenzzinssatz:parseFloat(e.target.value)}),className:"w-full px-2 py-1 border rounded"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-gray-600",children:"Alt: Miete (CHF)"}),(0,n.jsxs)("p",{className:"font-medium",children:["CHF ",m.alteMiete.toFixed(2)]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-gray-600",children:"Neu: Miete (CHF)"}),(0,n.jsx)("input",{type:"number",step:"0.01",value:m.neueMiete,onChange:e=>x({...m,neueMiete:parseFloat(e.target.value)}),className:"w-full px-2 py-1 border rounded"})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-gray-600 text-sm",children:"Begr\xfcndung"}),(0,n.jsx)("textarea",{value:m.begruendung,onChange:e=>x({...m,begruendung:e.target.value}),className:"w-full px-2 py-1 border rounded text-sm",rows:2})]}),m.zusaetzlicheGruende&&m.zusaetzlicheGruende.length>0&&(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-gray-600 text-sm",children:"Zus\xe4tzliche Gr\xfcnde"}),(0,n.jsx)("p",{className:"text-sm",children:m.zusaetzlicheGruende.join(", ")})]})]}),(0,n.jsxs)("div",{className:"flex gap-2",children:[(0,n.jsx)("button",{onClick:()=>{m&&(B({datum:m.datum,referenzzinssatz:m.neuerReferenzzinssatz,miete:m.neueMiete,typ:m.typ,begründung:m.begruendung,dokumentUrl:p,zusaetzlicheGruende:m.zusaetzlicheGruende}),x(null),b(""),u(!1))},className:"flex-1 bg-green-600 text-white py-2 rounded-lg hover:bg-green-700",children:"✓ \xdcbernehmen"}),(0,n.jsx)("button",{onClick:()=>{x(null),b("")},className:"flex-1 bg-gray-300 text-gray-700 py-2 rounded-lg hover:bg-gray-400",children:"✕ Ablehnen"})]})]}):(0,n.jsxs)("div",{children:[(0,n.jsx)("input",{type:"file",accept:".pdf,.jpg,.jpeg,.png",onChange:E,disabled:h,className:"w-full px-4 py-2 border border-gray-300 rounded-lg"}),h&&(0,n.jsx)("p",{className:"text-sm text-green-600 mt-2",children:"⏳ Wird analysiert..."})]})]}),d&&(0,n.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-6 space-y-4",children:[(0,n.jsx)("h4",{className:"font-bold text-gray-900",children:"✏️ Manuelle Erfassung"}),(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Datum *"}),(0,n.jsx)("input",{type:"date",value:z,onChange:e=>N(e.target.value),min:A.datum,className:"w-full px-4 py-2 border border-gray-300 rounded-lg"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Neuer Referenzzinssatz (%) *"}),(0,n.jsx)("input",{type:"number",step:"0.25",value:D,onChange:e=>H(e.target.value),placeholder:"z.B. 1.50",className:"w-full px-4 py-2 border border-gray-300 rounded-lg"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Neue Miete (CHF) *"}),(0,n.jsx)("input",{type:"number",step:"0.01",value:w,onChange:e=>C(e.target.value),placeholder:"Auto-berechnet",className:"w-full px-4 py-2 border border-gray-300 rounded-lg"}),(0,n.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Wird automatisch berechnet"})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Begr\xfcndung (optional)"}),(0,n.jsx)("textarea",{value:S,onChange:e=>k(e.target.value),placeholder:"z.B. Erh\xf6hung gem\xe4\xdf Brief vom...",className:"w-full px-4 py-2 border border-gray-300 rounded-lg",rows:2})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Zus\xe4tzliche Gr\xfcnde (optional)"}),(0,n.jsx)("div",{className:"flex gap-2 flex-wrap",children:["Teuerung","Kostensteigerung","Wertvermehrung"].map(e=>(0,n.jsx)("button",{type:"button",onClick:()=>{F.includes(e)?R(F.filter(t=>t!==e)):R([...F,e])},className:"px-3 py-1 rounded text-sm ".concat(F.includes(e)?"bg-blue-600 text-white":"bg-gray-200 text-gray-700"),children:e},e))})]}),(0,n.jsx)("button",{onClick:()=>{if(!z||!D||!w){alert("Bitte alle Pflichtfelder ausf\xfcllen");return}let e=parseFloat(w)>A.miete?"erh\xf6hung":"reduzierung";B({datum:z,referenzzinssatz:parseFloat(D),miete:parseFloat(w),typ:e,begründung:S||void 0,zusaetzlicheGruende:F.length>0?F:void 0}),N(""),v(""),C(""),k(""),R([]),c(!1)},className:"w-full bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700",children:"✓ Hinzuf\xfcgen"})]}),(0,n.jsx)("div",{className:"bg-white border border-gray-200 rounded-lg overflow-hidden",children:(0,n.jsx)("div",{className:"overflow-x-auto",children:(0,n.jsxs)("table",{className:"w-full",children:[(0,n.jsx)("thead",{className:"bg-gray-50",children:(0,n.jsxs)("tr",{children:[(0,n.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Datum"}),(0,n.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Referenzzins"}),(0,n.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Miete"}),(0,n.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"\xc4nderung"}),(0,n.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Begr\xfcndung"}),(0,n.jsx)("th",{className:"px-4 py-3"})]})}),(0,n.jsxs)("tbody",{className:"divide-y divide-gray-200",children:[(0,n.jsxs)("tr",{className:"bg-blue-50",children:[(0,n.jsx)("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-900",children:new Date(M.datum).toLocaleDateString("de-CH")}),(0,n.jsxs)("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-900",children:[M.referenzzinssatz,"%"]}),(0,n.jsxs)("td",{className:"px-4 py-3 whitespace-nowrap text-sm font-medium text-gray-900",children:["CHF ",M.miete.toFixed(2)]}),(0,n.jsx)("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-500",children:"\uD83C\uDFC1 Vertragsbeginn"}),(0,n.jsx)("td",{className:"px-4 py-3 text-sm text-gray-500",children:"-"}),(0,n.jsx)("td",{})]}),r.map((e,t)=>{let s=0===t?M:r[t-1],a=e.miete-s.miete;return(0,n.jsxs)("tr",{children:[(0,n.jsx)("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-900",children:new Date(e.datum).toLocaleDateString("de-CH")}),(0,n.jsxs)("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-900",children:[e.referenzzinssatz,"%"]}),(0,n.jsxs)("td",{className:"px-4 py-3 whitespace-nowrap text-sm font-medium text-gray-900",children:["CHF ",e.miete.toFixed(2),e.dokumentUrl&&(0,n.jsx)("a",{href:e.dokumentUrl,target:"_blank",rel:"noopener noreferrer",className:"ml-2 text-blue-600 hover:underline text-xs",children:"\uD83D\uDCC4"})]}),(0,n.jsxs)("td",{className:"px-4 py-3 whitespace-nowrap text-sm font-medium ".concat(a>0?"text-red-600":"text-green-600"),children:[a>0?"↑":"↓"," CHF ",Math.abs(a).toFixed(2)]}),(0,n.jsxs)("td",{className:"px-4 py-3 text-sm text-gray-600 max-w-xs truncate",children:[e.begründung||"-",e.zusaetzlicheGruende&&e.zusaetzlicheGruende.length>0&&(0,n.jsxs)("span",{className:"text-orange-600 ml-1",children:["+",e.zusaetzlicheGruende.length]})]}),(0,n.jsx)("td",{className:"px-4 py-3 whitespace-nowrap text-right text-sm",children:(0,n.jsx)("button",{onClick:()=>T(t),className:"text-red-600 hover:text-red-700",children:"✕"})})]},t)})]})]})})}),G.sollIstVergleiche.length>0&&(0,n.jsxs)("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4",children:[(0,n.jsx)("h4",{className:"font-bold text-gray-900 mb-3",children:"\uD83D\uDD0D Soll-Ist Vergleich"}),(0,n.jsx)("div",{className:"space-y-1 text-sm font-mono",children:G.sollIstVergleiche.map((e,t)=>(0,n.jsx)("div",{children:function(e){let t=new Date(e.datum).toLocaleDateString("de-CH"),s={korrekt:"✅",zu_hoch:"⚠️",zu_niedrig:"ℹ️",fehlend:"❌"}[e.status];return"".concat(s," ").concat(t,": Soll ").concat(e.sollMiete.toFixed(2)," @ ").concat(e.sollReferenzzins,"% | ")+"Ist ".concat(e.istMiete.toFixed(2)," @ ").concat(e.istReferenzzins,"% | ")+"".concat(e.erklaerung)}(e)},t))})]}),G.uebersprungeneSchritte.length>0&&(0,n.jsxs)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[(0,n.jsx)("h4",{className:"font-bold text-yellow-900 mb-2",children:"⚠️ \xdcbersprungene Zins\xe4nderungen"}),G.uebersprungeneSchritte.map((e,t)=>(0,n.jsx)("p",{className:"text-sm text-yellow-800",children:e},t))]}),G.falscheberechnungen.length>0&&(0,n.jsxs)("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-4",children:[(0,n.jsx)("h4",{className:"font-bold text-orange-900 mb-2",children:"⚠️ M\xf6gliche Berechnungsfehler"}),G.falscheberechnungen.map((e,t)=>(0,n.jsx)("p",{className:"text-sm text-orange-800 mb-2",children:e},t))]}),G.warnings.length>0&&(0,n.jsxs)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[(0,n.jsx)("h4",{className:"font-bold text-yellow-900 mb-2",children:"⚠️ Hinweise"}),G.warnings.map((e,t)=>(0,n.jsx)("p",{className:"text-sm text-yellow-800 mb-2",children:e},t))]}),G.kritisch.length>0&&(0,n.jsx)("div",{className:"bg-red-50 border-2 border-red-500 rounded-lg p-6",children:(0,n.jsx)("div",{className:"space-y-2",children:G.kritisch.map((e,t)=>(0,n.jsx)("p",{className:"".concat(0===t?"text-lg font-bold text-red-900":"text-sm text-red-800"),children:e},t))})}),G.errors.length>0&&(0,n.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[(0,n.jsx)("h4",{className:"font-bold text-red-900 mb-2",children:"❌ Fehler"}),G.errors.map((e,t)=>(0,n.jsx)("p",{className:"text-sm text-red-800",children:e},t))]}),(0,n.jsxs)("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-6",children:[(0,n.jsx)("h4",{className:"font-bold text-gray-900 mb-4",children:"\uD83D\uDCCD Aktueller Status"}),(0,n.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"text-sm text-gray-600",children:"Aktuelle Miete"}),(0,n.jsxs)("p",{className:"text-2xl font-bold text-gray-900",children:["CHF ",A.miete.toFixed(2)]}),(0,n.jsxs)("p",{className:"text-xs text-gray-500",children:["Basierend auf ",A.referenzzinssatz,"%"]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"text-sm text-gray-600",children:"Aktueller Referenzzins"}),(0,n.jsxs)("p",{className:"text-2xl font-bold text-gray-900",children:[f[0].satz,"%"]}),(0,n.jsxs)("p",{className:"text-xs text-gray-500",children:["Stand: ",new Date(f[0].datum).toLocaleDateString("de-CH")]})]})]})]})]})}function N(){let e=(0,r.useRouter)(),[t,s]=(0,a.useState)({address:"",netRent:"",currentRate:"1.25",contractDate:""}),[i,d]=(0,a.useState)(null),[m,x]=(0,a.useState)(null),[p,f]=(0,a.useState)(!1),[y,j]=(0,a.useState)(null),[N,D]=(0,a.useState)(!1),v=e=>{s({...t,[e.target.name]:e.target.value})},w=()=>{if(!t.address.trim())return"Bitte geben Sie die Adresse der Mietwohnung ein";if(!t.netRent||0>=parseFloat(t.netRent))return"Bitte geben Sie eine g\xfcltige Nettomiete ein";if(100>parseFloat(t.netRent))return"Die Nettomiete scheint zu niedrig zu sein (< CHF 100)";if(parseFloat(t.netRent)>2e4)return"Die Nettomiete scheint zu hoch zu sein (> CHF 20'000). Bitte pr\xfcfen Sie die Eingabe.";if(!t.contractDate)return"Bitte geben Sie das Vertragsdatum ein";let e=new Date(t.contractDate);return e>new Date?"Das Vertragsdatum kann nicht in der Zukunft liegen":e<new Date("1990-01-01")?"Das Vertragsdatum scheint zu weit in der Vergangenheit zu liegen":null},C=async e=>{e.preventDefault();let s=w();if(s){o(s);return}D(!0),j(null);let n=u("Berechnung l\xe4uft...");try{let e=await fetch("/api/analyze",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({address:t.address,currentRent:parseFloat(t.netRent),currentReferenceRate:parseFloat(t.currentRate),newReferenceRate:1.25,contractDate:t.contractDate,mietHistorie:m})});h(n);let s=await e.json();if(!e.ok)throw Error(s.error||"Berechnung fehlgeschlagen");j(s),s.monthlyReduction>0?c("Sie k\xf6nnen CHF ".concat(s.monthlyReduction.toFixed(2),"/Monat sparen!")):o("Leider kein Einsparungspotential gefunden. Der aktuelle Referenzzinssatz ist bereits optimal f\xfcr Sie.")}catch(e){h(n),o(function(e){if(e instanceof Error){if(e.message.includes("fetch")||e.message.includes("network"))return g.networkError;if(e.message.includes("timeout"))return g.analysisTimeout;if(e.message.includes("500")||e.message.includes("server"))return g.serverError;if(e.message.length<100&&!e.message.includes("Error:"))return e.message}return g.genericError}(e))}finally{D(!1)}};return(0,n.jsx)("div",{className:"min-h-screen bg-gradient-to-b from-blue-50 to-white py-12 px-4",children:(0,n.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,n.jsxs)("div",{className:"text-center mb-8",children:[(0,n.jsx)(l.default,{href:"/",className:"text-blue-600 hover:text-blue-700 mb-4 inline-block",children:"← Zur\xfcck zur Startseite"}),(0,n.jsx)("h1",{className:"text-4xl font-bold text-gray-900 mb-4",children:"Service 1: Mietvertrag-Analyse"}),(0,n.jsx)("p",{className:"text-xl text-gray-600",children:"Laden Sie Ihren Mietvertrag hoch f\xfcr eine automatische Analyse"}),(0,n.jsx)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mt-4 inline-block",children:(0,n.jsxs)("p",{className:"text-sm text-blue-800",children:["\uD83D\uDCB0 ",(0,n.jsx)("strong",{children:"Kosten:"})," CHF 20 (einmalig)"]})})]}),(0,n.jsxs)("div",{className:"bg-white rounded-lg shadow-lg p-8 mb-8",children:[(0,n.jsx)("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"\uD83E\uDD16 Automatische Analyse mit KI"}),(0,n.jsx)("p",{className:"text-gray-600 mb-6",children:"Laden Sie Ihren Mietvertrag hoch (PDF, JPG oder PNG). Unsere KI extrahiert automatisch:"}),(0,n.jsxs)("ul",{className:"list-disc list-inside text-gray-600 mb-6 space-y-2",children:[(0,n.jsx)("li",{children:"Adresse der Mietwohnung"}),(0,n.jsx)("li",{children:"Nettomiete (Grundmiete ohne Nebenkosten)"}),(0,n.jsx)("li",{children:"Referenzzinssatz bei Vertragsabschluss"}),(0,n.jsx)("li",{children:"Vertragsdatum"}),(0,n.jsx)("li",{children:"Vermieterinformationen"})]}),(0,n.jsx)(b,{onAnalysisComplete:e=>{console.log("\uD83D\uDCCA Auto-filling form with analyzed data:",e),d(e),s({address:e.address,netRent:e.netRent.toString(),currentRate:e.referenceRate.toString(),contractDate:e.contractDate}),f(!0),c("Vertragsdaten erfolgreich extrahiert!")}})]}),(0,n.jsxs)("div",{className:"bg-white rounded-lg shadow-lg p-8 mb-8",children:[(0,n.jsxs)("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:["✏️ Vertragsdaten ",t.address&&"(automatisch ausgef\xfcllt)"]}),(0,n.jsx)("p",{className:"text-gray-600 mb-6",children:t.address?"Bitte \xfcberpr\xfcfen Sie die automatisch ausgef\xfcllten Daten und korrigieren Sie sie bei Bedarf.":"Oder geben Sie die Daten manuell ein, falls Sie keinen Vertrag hochladen m\xf6chten."}),(0,n.jsxs)("form",{onSubmit:C,className:"space-y-6",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\uD83D\uDCCD Adresse der Mietwohnung *"}),(0,n.jsx)("input",{type:"text",name:"address",value:t.address,onChange:v,placeholder:"z.B. Musterstrasse 123, 8000 Z\xfcrich",required:!0,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\uD83D\uDCB0 Nettomiete (CHF/Monat) *"}),(0,n.jsx)("input",{type:"number",name:"netRent",value:t.netRent,onChange:v,placeholder:"z.B. 2000",step:"0.01",min:"0",required:!0,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),(0,n.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:"Grundmiete ohne Nebenkosten (CHF 100 - 20'000)"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\uD83D\uDCCA Referenzzinssatz bei Vertragsabschluss (%) *"}),(0,n.jsxs)("select",{name:"currentRate",value:t.currentRate,onChange:v,required:!0,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[(0,n.jsx)("option",{value:"1.25",children:"1.25% (seit Sept 2025)"}),(0,n.jsx)("option",{value:"1.50",children:"1.50% (M\xe4rz - Aug 2025)"}),(0,n.jsx)("option",{value:"1.75",children:"1.75% (Dez 2023 - Feb 2025)"}),(0,n.jsx)("option",{value:"2.00",children:"2.00% oder h\xf6her"})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\uD83D\uDCC5 Vertragsdatum *"}),(0,n.jsx)("input",{type:"date",name:"contractDate",value:t.contractDate,onChange:v,required:!0,max:new Date().toISOString().split("T")[0],className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),(0,n.jsx)("button",{type:"submit",disabled:N,className:"w-full bg-blue-600 text-white py-4 rounded-lg font-bold text-lg hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors flex items-center justify-center gap-2",children:N?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("svg",{className:"animate-spin h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,n.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,n.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Berechnung l\xe4uft..."]}):"\uD83E\uDDEE Einsparung berechnen"})]}),y&&(0,n.jsxs)("div",{className:"mt-8 bg-green-50 border-2 border-green-500 rounded-lg p-6 animate-fadeIn",children:[(0,n.jsx)("h3",{className:"text-2xl font-bold text-green-900 mb-4",children:"\uD83C\uDF89 Ihr Einsparungspotential"}),(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,n.jsxs)("div",{className:"bg-white rounded-lg p-4 shadow-sm",children:[(0,n.jsx)("p",{className:"text-sm text-gray-600",children:"Aktuelle Miete"}),(0,n.jsxs)("p",{className:"text-2xl font-bold text-gray-900",children:["CHF ",y.currentRent.toFixed(2)]})]}),(0,n.jsxs)("div",{className:"bg-white rounded-lg p-4 shadow-sm",children:[(0,n.jsx)("p",{className:"text-sm text-gray-600",children:"Neue Miete"}),(0,n.jsxs)("p",{className:"text-2xl font-bold text-green-600",children:["CHF ",y.newRent.toFixed(2)]})]}),(0,n.jsxs)("div",{className:"bg-white rounded-lg p-4 shadow-sm",children:[(0,n.jsx)("p",{className:"text-sm text-gray-600",children:"Monatliche Reduktion"}),(0,n.jsxs)("p",{className:"text-2xl font-bold text-blue-600",children:["CHF ",y.monthlyReduction.toFixed(2)]})]}),(0,n.jsxs)("div",{className:"bg-white rounded-lg p-4 shadow-sm",children:[(0,n.jsx)("p",{className:"text-sm text-gray-600",children:"J\xe4hrliche Einsparung"}),(0,n.jsxs)("p",{className:"text-2xl font-bold text-blue-600",children:["CHF ",y.yearlySavings.toFixed(2)]})]})]}),(0,n.jsxs)("div",{className:"mt-6 text-center",children:[(0,n.jsx)("button",{onClick:()=>{let s={contract:{address:t.address,landlordName:(null==i?void 0:i.landlordName)||"",landlordAddress:(null==i?void 0:i.landlordAddress)||"",contractDate:t.contractDate,netRent:parseFloat(t.netRent),referenceRate:parseFloat(t.currentRate)},calculation:{currentRent:y.currentRent,newRent:y.newRent,monthlyReduction:y.monthlyReduction,yearlySavings:y.yearlySavings},historie:m,hasHistory:y.hasHistory||!1,einsparungDetails:y.einsparungDetails||null,validation:y.validation||null};window.sessionStorage&&(sessionStorage.setItem("mietCheckData",JSON.stringify(s)),console.log("\uD83D\uDCBE Saved complete data to sessionStorage:",s)),c("Daten gespeichert - Weiterleitung..."),e.push("/generate")},className:"inline-block bg-green-600 text-white px-8 py-3 rounded-lg font-bold hover:bg-green-700 transition-colors",children:"\uD83D\uDCC4 Weiter zu Service 2: Brief generieren"}),(0,n.jsx)("p",{className:"text-sm text-gray-600 mt-2",children:"\uD83D\uDCA1 Alle Daten werden automatisch \xfcbernommen"})]})]})]}),p&&t.contractDate&&t.netRent&&t.currentRate&&(0,n.jsx)("div",{className:"bg-white rounded-lg shadow-lg p-8 mb-8",children:(0,n.jsx)(z,{vertragsbeginn:{datum:t.contractDate,miete:parseFloat(t.netRent),referenzzinssatz:parseFloat(t.currentRate)},onHistorieChange:e=>{x(e)}})}),(0,n.jsxs)("div",{className:"mt-8 bg-gray-50 border border-gray-200 rounded-lg p-6",children:[(0,n.jsx)("h3",{className:"text-lg font-bold text-gray-900 mb-3",children:"ℹ️ Wichtige Hinweise"}),(0,n.jsxs)("ul",{className:"text-sm text-gray-600 space-y-2",children:[(0,n.jsx)("li",{children:"• Die Berechnung basiert auf Art. 13 VMWG (Mietrecht)"}),(0,n.jsx)("li",{children:"• Der aktuelle Referenzzinssatz betr\xe4gt 1.25% (seit Sept 2025)"}),(0,n.jsx)("li",{children:"• Nur Mietvertr\xe4ge mit Referenzzinssatz-Klausel sind berechtigt"}),(0,n.jsx)("li",{children:"• Die KI-Analyse ist ein Hilfsmittel - bitte pr\xfcfen Sie die Daten"}),(0,n.jsxs)("li",{children:["• ",(0,n.jsx)("strong",{children:"NEU:"})," Erfassen Sie alle bisherigen Mietanpassungen f\xfcr eine pr\xe4zisere Berechnung"]}),(0,n.jsxs)("li",{children:["• ",(0,n.jsx)("strong",{children:"NEU:"})," Alle Daten werden automatisch an Service 2 \xfcbergeben - Sie m\xfcssen nichts zweimal eingeben!"]})]})]})]})})}}},function(e){e.O(0,[648,64,815,971,117,744],function(){return e(e.s=7591)}),_N_E=e.O()}]);