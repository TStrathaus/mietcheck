"use strict";(()=>{var e={};e.id=364,e.ids=[364],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},64992:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>f,patchFetch:()=>m,requestAsyncStorage:()=>h,routeModule:()=>g,serverHooks:()=>p,staticGenerationAsyncStorage:()=>d});var n={};r.r(n),r.d(n,{POST:()=>u});var o=r(49303),a=r(88716),s=r(60670),i=r(87070),l=r(64937),c=r(67297);async function u(e){try{let t;let{blobUrl:r,fileType:n}=await e.json();if(!r||!n)return i.NextResponse.json({error:"Blob URL und fileType sind erforderlich"},{status:400});if(console.log("\uD83D\uDCC4 Processing upload:",{blobUrl:r,fileType:n}),(0,c.TI)(n))console.log("\uD83D\uDCD1 Processing as PDF..."),t=await (0,l.C)(r);else{if(!(0,c.DW)(n))return i.NextResponse.json({error:`Nicht unterst\xfctzter Dateityp: ${n}. Nur PDF, JPG und PNG werden unterst\xfctzt.`},{status:400});console.log("\uD83D\uDDBC️ Processing as Image with OCR..."),t=await (0,c.oI)(r,n)}if(!t||0===t.trim().length)return i.NextResponse.json({error:"Kein Text konnte extrahiert werden. Bitte pr\xfcfen Sie die Datei."},{status:400});return console.log("✅ Text extraction successful, length:",t.length),i.NextResponse.json({success:!0,extractedText:t,url:r})}catch(e){return console.error("❌ Process upload error:",e),i.NextResponse.json({error:"Dateiverarbeitung fehlgeschlagen: "+e.message},{status:500})}}let g=new o.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/process-upload/route",pathname:"/api/process-upload",filename:"route",bundlePath:"app/api/process-upload/route"},resolvedPagePath:"D:\\STTH\\2026 KI\\mietcheck\\src\\app\\api\\process-upload\\route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:h,staticGenerationAsyncStorage:d,serverHooks:p}=g,f="/api/process-upload/route";function m(){return(0,s.patchFetch)({serverHooks:p,staticGenerationAsyncStorage:d})}},67297:(e,t,r)=>{async function n(e,t){let r=process.env.GEMINI_API_KEY;if(!r)throw Error("GEMINI_API_KEY nicht konfiguriert");console.log("\uD83D\uDDBC️ Extracting text from image using Gemini Vision..."),console.log("\uD83D\uDCF7 Image URL:",e),console.log("\uD83D\uDCCB MIME type:",t);try{let n=await fetch(e);if(!n.ok)throw Error(`Failed to fetch image: ${n.status}`);let o=await n.arrayBuffer(),a=Buffer.from(o).toString("base64");console.log("✅ Image downloaded, size:",o.byteLength,"bytes");let s=`https://generativelanguage.googleapis.com/v1/models/gemini-2.5-flash:generateContent?key=${r}`,i=await fetch(s,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{parts:[{inline_data:{mime_type:t,data:a}},{text:"Extract all text from this image. Include all visible text, numbers, dates, and addresses. Return only the extracted text without any additional commentary or explanations."}]}],generationConfig:{temperature:.1,maxOutputTokens:4096}})});if(!i.ok){let e=await i.text();throw Error(`Gemini Vision API Error ${i.status}: ${e}`)}let l=await i.json(),c=l.candidates?.[0]?.content?.parts?.[0]?.text;if(!c)throw Error("Keine Text-Extraktion von Gemini erhalten");return console.log("✅ Text extracted successfully, length:",c.length),console.log("\uD83D\uDCC4 First 200 chars:",c.substring(0,200)),c}catch(e){throw console.error("❌ Image OCR error:",e),Error(`Image-Texterkennung fehlgeschlagen: ${e.message}`)}}function o(e){return e.startsWith("image/")}function a(e){return"application/pdf"===e}r.d(t,{DW:()=>o,TI:()=>a,oI:()=>n})},64937:(e,t,r)=>{let n,o;async function a(e,t={}){let{getDocument:r}=await s();return await r({data:e,isEvalSupported:!1,useSystemFonts:!0,...t}).promise}async function s(){return n||await i(),n}async function i(e,{reload:t=!1}={}){if(!n||t){if(e)try{n=await l(e());return}catch(e){throw Error(`PDF.js could not be resolved: ${e}`)}try{n=await r.e(602).then(r.bind(r,48602))}catch(e){throw Error(`Serverless PDF.js bundle could not be resolved: ${e}`)}}}async function l(e){let t=await e;return t.default||t}r.d(t,{C:()=>d}),globalThis.process?.release?.name;class c{#e=!1;constructor({enableHWA:e=!1}={}){this.#e=e}create(e,t){let r=this._createCanvas(e,t);return{canvas:r,context:r.getContext("2d",{willReadFrequently:!this.#e})}}reset({canvas:e},t,r){if(!e)throw Error("Canvas is not specified");e.width=t,e.height=r}destroy(e){if(!e.canvas)throw Error("Canvas is not specified");e.canvas.width=0,e.canvas.height=0,e.canvas=void 0,e.context=void 0}_createCanvas(e,t){throw Error("Not implemented")}}async function u(e,t={}){let{mergePages:r=!1}=t,n="object"==typeof e&&null!==e&&"_pdfInfo"in e?e:await a(e),o=await Promise.all(Array.from({length:n.numPages},(e,t)=>g(n,t+1)));return{totalPages:n.numPages,text:r?o.join("\n").replace(/\s+/g," "):o}}async function g(e,t){let r=await e.getPage(t);return(await r.getTextContent()).items.filter(e=>null!=e.str).map(e=>e.str+(e.hasEOL?"\n":"")).join("")}let h=async(...e)=>(await i(),await u(...e));async function d(e){try{console.log("\uD83D\uDCE5 Fetching PDF from:",e);let t=await fetch(e);if(!t.ok)throw Error(`Failed to fetch PDF: ${t.status}`);let r=await t.arrayBuffer();console.log("\uD83D\uDCE6 PDF size:",r.byteLength,"bytes");let{text:n,totalPages:o}=await h(r,{mergePages:!0}),a=n.trim();if(console.log("\uD83D\uDCC4 PDF extraction successful:",{pages:o||0,textLength:a.length,preview:a.substring(0,150)+"..."}),a.length<50)throw console.warn("⚠️ Extracted text too short:",a.length,"chars"),Error("PDF enth\xe4lt zu wenig Text (m\xf6glicherweise nur Bilder). Bitte verwenden Sie ein PDF mit Text-Ebene.");return a}catch(e){throw console.error("❌ PDF extraction error:",{message:e.message,stack:e.stack,name:e.name}),Error(`PDF-Extraktion fehlgeschlagen: ${e.message}`)}}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[948,972],()=>r(64992));module.exports=n})();