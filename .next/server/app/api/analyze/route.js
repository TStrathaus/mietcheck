"use strict";(()=>{var e={};e.id=652,e.ids=[652],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6204:(e,t,a)=>{a.r(t),a.d(t,{originalPathname:()=>g,patchFetch:()=>z,requestAsyncStorage:()=>p,routeModule:()=>m,serverHooks:()=>h,staticGenerationAsyncStorage:()=>c});var n={};a.r(n),a.d(n,{POST:()=>d});var r=a(49303),i=a(88716),s=a(60670),o=a(87070);let l=[{datum:"2025-09-02",satz:1.25},{datum:"2025-03-03",satz:1.5},{datum:"2023-12-01",satz:1.75},{datum:"2023-06-01",satz:1.5},{datum:"2022-12-01",satz:1.25},{datum:"2022-06-01",satz:1.25},{datum:"2020-03-02",satz:1.25},{datum:"2019-06-03",satz:1.25},{datum:"2017-06-01",satz:1.5},{datum:"2016-09-01",satz:1.5},{datum:"2015-09-01",satz:1.75}];function u(e,t,a){return Math.round(e*(1+(a-t)/.25*3/100)*100)/100}async function d(e){try{let{address:t,currentRent:a,currentReferenceRate:n,newReferenceRate:r,contractDate:i,mietHistorie:s}=await e.json();if(!t||!a||!n||!r)return o.NextResponse.json({error:"Fehlende Pflichtfelder"},{status:400});if(s){console.log("\uD83D\uDCCA Calculating with MietHistorie:",s);let e=function(e){let t=[],a=[],n=[e.vertragsbeginn.datum,...e.anpassungen.map(e=>e.datum)];for(let e=1;e<n.length;e++)new Date(n[e])<=new Date(n[e-1])&&t.push(`Datum ${n[e]} ist nicht chronologisch`);let r=e.vertragsbeginn;for(let t of e.anpassungen){let e=function(e,t,a,n){let r=u(e,t,n),i=Math.abs(a-r);return{isValid:i<.5,sollMiete:r,differenz:i}}(r.miete,r.referenzzinssatz,t.miete,t.referenzzinssatz);e.isValid||a.push(`Anpassung ${t.datum}: Miete sollte CHF ${e.sollMiete.toFixed(2)} sein, ist aber CHF ${t.miete.toFixed(2)} (Differenz: CHF ${e.differenz.toFixed(2)})`),r=t}let i=l[0].satz,s=e.aktuell||r;if(s.referenzzinssatz>i){let e=u(s.miete,s.referenzzinssatz,i);return a.push(`⚠️ Einsparungspotential: Der aktuelle Referenzzinssatz ist ${i}% (seit ${l[0].datum}). Ihre Miete sollte CHF ${e.toFixed(2)} betragen statt CHF ${s.miete.toFixed(2)}. M\xf6gliche Einsparung: CHF ${(s.miete-e).toFixed(2)}/Monat`),{isValid:0===t.length,errors:t,warnings:a,sollMiete:e,istMiete:s.miete,differenz:s.miete-e}}return{isValid:0===t.length,errors:t,warnings:a}}(s);if(!e.isValid)return o.NextResponse.json({error:"Miethistorie enth\xe4lt Fehler",validationErrors:e.errors},{status:400});let t=s.aktuell,a=u(t.miete,t.referenzzinssatz,r),n=t.miete-a,i=null;return e.sollMiete&&e.istMiete&&(i=function(e,t,a){let n=t-e,r=new Date(a),i=Math.floor((new Date().getTime()-r.getTime())/2592e6);return{monatlich:n,jaehrlich:12*n,gesamt:n*i,monate:i}}(e.sollMiete,e.istMiete,t.datum)),o.NextResponse.json({currentRent:t.miete,newRent:a,monthlyReduction:n,yearlySavings:12*n,validation:{warnings:e.warnings,errors:e.errors},einsparungDetails:i,hasHistory:!0})}console.log("\uD83D\uDCCA Simple calculation without history");let d=r-n,m=d/.25*3,p=a*(1+m/100),c=a-p;return console.log("\uD83D\uDCCA Rent calculation:",{currentRent:a,currentReferenceRate:n,newReferenceRate:r,rateDifference:d,percentageChange:m.toFixed(2)+"%",newRent:p.toFixed(2),monthlyReduction:c.toFixed(2)}),o.NextResponse.json({currentRent:a,newRent:p,monthlyReduction:c,yearlySavings:12*c,rateDifference:d,percentageChange:m,hasHistory:!1})}catch(e){return console.error("❌ Analyze error:",e),o.NextResponse.json({error:"Berechnung fehlgeschlagen: "+e.message},{status:500})}}let m=new r.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/analyze/route",pathname:"/api/analyze",filename:"route",bundlePath:"app/api/analyze/route"},resolvedPagePath:"D:\\STTH\\2026 KI\\mietcheck\\src\\app\\api\\analyze\\route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:p,staticGenerationAsyncStorage:c,serverHooks:h}=m,g="/api/analyze/route";function z(){return(0,s.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:c})}}};var t=require("../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),n=t.X(0,[948,972],()=>a(6204));module.exports=n})();